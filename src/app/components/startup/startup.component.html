<main>
  <div class="spinner">
    <mat-spinner *ngIf="isSelected | async; else startupView" mode="indeterminate" color="primary">
    </mat-spinner>
  </div>
  <ng-template #startupView>
    <div class="template" *ngIf="currentStartup.nonBlock; else blockStartupView">
      <div class="imageBlock">
        <mat-card>
          <img class="imgParametrs" src="https://drive.google.com/thumbnail?id={{(startup | async)?.compressedImageId}}"
               onError="this.src='/src/assets/images/defaultImageForStartup.png';">
        </mat-card>
      <div *ngIf="currentStartup.nonBlock">
        <ng-template ngxPermissionsOnly="ADMIN">  <button (click)="blockStartup(currentStartup)"> Block Startup  </button></ng-template>
      </div>
    </div>


      <div class="rightFromImageBlock">
        <h3> {{(startup | async)?.startupName}} </h3>
        <p style="text-align: justify"><br/> {{(startup | async)?.idea}} </p>

        <p>
          <b style="margin-right: 30px">Need investments:</b>

          {{(startup | async)?.sumOfInvestment}}$
          <br/>
          <b style="margin-right: 15px">Current investments:</b>

          {{currentInvestments}}$
        </p>
      </div>

      <div class="block">
        <h3><b> About project:</b></h3>
        <p> {{(startup | async)?.aboutProject}}</p>
        <mat-divider></mat-divider>
      </div>

      <div class="block">
        <h3><b> Business plan:</b></h3>
        <p> {{(startup | async)?.businessPlan}}</p>
        <mat-divider></mat-divider>
      </div>


      <div class="blockText">
        <h3><b> Members:</b></h3>
      </div>
      <div>
        <mat-card style="width: 250px; margin-right: 15px; margin-top: 15px; margin-bottom: 15px">
          <mat-card-header>
            <img mat-card-avatar src="https://drive.google.com/thumbnail?id={{(startup | async)?.account.compressedImageId}}" onError="this.src='/src/assets/images/Person.jpg'">
            <mat-card-title *ngIf="(startup | async)?.account!==null"> {{(startup | async)?.account.firstName}} <br/>
              {{(startup | async)?.account.lastName}}
            </mat-card-title>
            <mat-card-title *ngIf="(startup | async)?.account===null"> UNKNOWN</mat-card-title>
            <mat-card-subtitle> LEADER</mat-card-subtitle>
          </mat-card-header>
        </mat-card>
      </div>

      <div *ngFor="let res of (startup | async)?.startupResumes">
        <mat-card style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px; width: 250px" *ngIf="res?.accepted === true ">
          <mat-card-header>
            <img mat-card-avatar src="https://drive.google.com/thumbnail?id={{res.resume.account?.compressedImageId}}" onError="this.src='/src/assets/images/Person.jpg'">
            <mat-card-title> {{res.resume.account?.firstName}}<br/> {{res.resume.account?.lastName}}</mat-card-title>
            <mat-card-subtitle> {{res.resume.businessRole.businessRoleName}} {{getStartupRole(res.resume.account.id)}}</mat-card-subtitle>
            <i class="material-icons" *ngIf="(currentUser|async)?.account.id === res.resume.account.id" (click)="deleteMyResumeFromStartup(res.id)" style="cursor: pointer">
              delete
            </i>
          </mat-card-header>
        </mat-card>
      </div>

      <mat-divider style="width: 90%"></mat-divider>



  <div class="template" style="width: 100%">
      <div class="blockText" *ngIf="(myPendingResumes !== undefined) &&(myPendingResumes.length > 0)">
        <h3><b> Your pending resumes: </b></h3>
      </div>
      <div *ngFor="let resume of myPendingResumes">
        <mat-card style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px; width: 250px">
          <mat-card-header>
            <img mat-card-avatar src="https://drive.google.com/thumbnail?id={{resume.resume.account?.compressedImageId}}" onError="this.src='/src/assets/images/Person.jpg'">
            <mat-card-title> {{resume.resume.account?.firstName}}<br/> {{resume.resume.account.lastName}}</mat-card-title>
            <mat-card-subtitle> {{resume.resume.businessRole.businessRoleName}}</mat-card-subtitle>
            <i class="material-icons" (click)="cancelResume(resume.id)" style="cursor: pointer">
              delete
            </i>
          </mat-card-header>

        </mat-card>
      </div>
      <mat-divider style="width: 90%"></mat-divider>
  </div>
      <div class="blockText">
        <h3><b> Top Investors: </b></h3>
      </div>
        <div *ngFor="let investment of investments">
          <mat-card style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px; width: 250px">
            <mat-card-header>
              <img mat-card-avatar src="https://drive.google.com/thumbnail?id={{investment.investor?.compressedImageId}}" onError="this.src='/src/assets/images/Person.jpg'">
              <mat-card-title> {{investment.investor?.firstName}}<br/> {{investment.investor?.lastName}}</mat-card-title>
              <mat-card-subtitle> {{investment.sumOfInvestment}}$</mat-card-subtitle>
            </mat-card-header>
          </mat-card>
        </div>



      <mat-divider style="width: 90%"></mat-divider>
      <div style="width: 90%">
        <button mat-raised-button="" class="btnControl" (click)="joinStartup()"
                *ngIf="((currentUser|async) && (currentUser|async)?.account.id !== (startup | async)?.account.id)"> Send resume
        </button>
        <button mat-raised-button="" class="btnControl" (click)="makeInvestments()"
                *ngIf="((currentUser|async) && (currentUser|async)?.account.id !== (startup | async)?.account.id)"> Make investments
        </button>
        <button mat-raised-button="" class="btnControl" routerLink="/startup-edit/{{id}}"
                *ngIf="currentUser && (((currentUser|async)?.account.id === (startup | async)?.account.id) || permissionToEdit)"> Edit
        </button>
        <button mat-raised-button="" class="btnControl" (click)="deleteStartup()"
                *ngIf="(currentUser|async) && ((currentUser|async)?.account.id === (startup | async)?.account.id)">
          Delete
        </button>
        <button mat-raised-button="" class="btnControl" (click)="leaveStartup()"
                *ngIf="(currentUser|async) &&  permissionToLeave">
          Leave
        </button>

      </div>
    </div>
  </ng-template>

</main>

<ng-template #blockStartupView>
<div *ngIf="!currentStartup.nonBlock"> Данная страница заблокирована
  <ng-template ngxPermissionsOnly="ADMIN">  <button (click)="unBlockStartup(currentStartup)"> Unblock Startup  </button></ng-template>
</div>
</ng-template>

<ng-template #emptyPendingResume>
  <h5 style="margin-top: 20px"> No pending member at that moment </h5>
</ng-template>

<ng-template #emptyInvestors>
  <h5 style="margin-top: 20px"> No investors yet </h5>
</ng-template>
